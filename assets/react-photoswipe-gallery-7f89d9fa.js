import{a as Z,r as l}from"./react-b146d822.js";import{P as et}from"./photoswipe-dc4bf523.js";import{r as nt}from"./react-dom-edc23fff.js";import{P as r}from"./prop-types-73e30d6e.js";class rt extends Error{constructor(){super(...arguments),this.message="No valid `ref` provided.\nYou should use `ref` from render prop of Item component.\nExample:\n<Item>{({ ref }) => <div ref={ref}></div>}</Item>\n"}}function ot(e,t){if(!(e instanceof Element)||!(t instanceof Element))throw new rt;return e===t?0:e.compareDocumentPosition(t)&2?1:-1}function q(e){return Object.entries(e).map(([t,c])=>c?`${t}=${c}`:t).join("&")}function G(e){return e.split("&").reduce((t,c)=>{const[n,o]=c.split("=");return n&&(t[n]=o),t},{})}function V(e){const t=G(e);return delete t.gid,delete t.pid,q(t)}function E(){return window.location.hash.substring(1)}function Y(){return`${window.location.pathname}${window.location.search}`}const X=e=>{const t=G(e);return!!t.gid&&!!t.pid};function it(e,t){return e!==null?e:t?parseInt(t,10)-1:0}const Q=Z.createContext({remove:()=>{},set:()=>{},handleClick:()=>{},open:()=>{}});class st{constructor(t){this.pswp=t,this.on=t.on.bind(t),this.off=t.off.bind(t),this.dispatch=t.dispatch.bind(t)}}var at=globalThis&&globalThis.__rest||function(e,t){var c={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(c[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(c[n[o]]=e[n[o]]);return c};let y=null;const ct=({children:e,options:t,plugins:c,uiElements:n,id:o,onBeforeOpen:S,onOpen:P,withCaption:j,withDownloadButton:_})=>{const[F,H]=l.useState(null),v=l.useRef(new Map),w=l.useRef(null),m=l.useCallback((d,g,b,p)=>{if(y)return;let x=b||null;const I=[],N=Array.from(v.current),W=(s,i)=>{const[f,u]=s,{width:h,height:O,original:$,originalSrcset:k,thumbnail:D,cropped:U,content:z,id:A}=u,tt=at(u,["width","height","original","originalSrcset","thumbnail","cropped","content","id"]);(d===f||A!==void 0&&String(A)===g)&&(x=i),I.push(Object.assign(Object.assign(Object.assign({w:Number(h),h:Number(O),src:$,srcset:k,msrc:D,element:f.current,thumbCropped:U,content:z},z!==void 0?{type:"html"}:{}),A!==void 0?{pid:A}:{}),tt))};v.current.size>1?N.sort(([{current:s}],[{current:i}])=>ot(s,i)).forEach(W):N.forEach(W);const K=p&&p.clientX!==void 0&&p.clientY!==void 0?{x:p.clientX,y:p.clientY}:null,a=new et(Object.assign({dataSource:I,index:it(x,g),initialPointerPos:K},t||{}));y=a,a.on("contentActivate",({content:s})=>{s.data.content?H(nt.createPortal(s.data.content,s.element)):H(null)}),a.on("close",()=>{H(null)}),_&&a.on("uiRegister",()=>{var s;(s=a.ui)===null||s===void 0||s.registerElement({name:"download-button",ariaLabel:"Download",order:8,isButton:!0,tagName:"a",appendTo:"bar",html:{isCustomSVG:!0,inner:'<path d="M20.5 14.3 17.1 18V10h-2.2v7.9l-3.4-3.6L10 16l6 6.1 6-6.1ZM23 23H9v2h14Z" id="pswp__icn-download"/>',outlineID:"pswp__icn-download"},onInit:(i,f)=>{i.setAttribute("download",""),i.setAttribute("target","_blank"),i.setAttribute("rel","noopener"),a.on("change",()=>{var u;if(!(!((u=f.currSlide)===null||u===void 0)&&u.data.src))return;const h=i;h.href=f.currSlide.data.src})}})}),j&&a.on("uiRegister",()=>{var s;(s=a.ui)===null||s===void 0||s.registerElement({name:"default-caption",order:9,isButton:!1,appendTo:"root",onInit:(i,f)=>{i.style.position="absolute",i.style.bottom="15px",i.style.left="0",i.style.right="0",i.style.padding="0 20px",i.style.color="var(--pswp-icon-color)",i.style.textAlign="center",i.style.fontSize="14px",i.style.lineHeight="1.5",i.style.textShadow="1px 1px 3px var(--pswp-icon-color-secondary)",a.on("change",()=>{if(!f.currSlide)return;const{caption:u,alt:h}=f.currSlide.data;i.innerHTML=u||h||""})}})}),Array.isArray(n)&&n.forEach(s=>{a.on("uiRegister",()=>{var i;(i=a.ui)===null||i===void 0||i.registerElement(s)})}),typeof c=="function"&&c(new st(a)),typeof S=="function"&&S(a);const C=()=>({gallery:{galleryUID:o}});a.on("beforeOpen",()=>{var s;if(o===void 0)return;if(!X(E())){window.history.pushState(C(),document.title);return}if(!!(!((s=window.history.state)===null||s===void 0)&&s.gallery))return;const u=Y(),h=E(),O=V(h),$=`${u}${O?`#${O}`:""}`,k=`${u}#${h}`;window.history.replaceState(window.history.state,document.title,$),window.history.pushState(C(),document.title,k)}),a.on("change",()=>{var s;if(o===void 0)return;const i=((s=a.currSlide)===null||s===void 0?void 0:s.data.pid)||a.currIndex+1,f=Y(),u=V(E()),h=q({gid:o,pid:i}),O=`${f}#${u}&${h}`;window.history.replaceState(C(),document.title,O)});const M=()=>{o!==void 0&&y!==null&&y.close()};window.addEventListener("popstate",M),a.on("destroy",()=>{o!==void 0&&(window.removeEventListener("popstate",M),X(E())&&window.history.back()),y=null}),a.init(),typeof P=="function"&&P(a)},[t,c,n,o,S,P,j,_]);l.useEffect(()=>()=>{y&&y.close()},[]);const T=l.useCallback(()=>{if(o===void 0||y!==null)return;const d=E();if(d.length<5)return;const g=G(d),{pid:b,gid:p}=g;if(!(!b||!p)){if(v.current.size===0){w.current=b;return}b&&p===String(o)&&m(null,b)}},[m,o]);l.useEffect(()=>(T(),window.addEventListener("popstate",T),()=>{window.removeEventListener("popstate",T)}),[T]);const R=l.useCallback(d=>{v.current.delete(d)},[]),L=l.useCallback((d,g)=>{const{id:b}=g;if(v.current.set(d,g),w.current!==null){if(b===w.current){m(d),w.current=null;return}if(!b){const p=parseInt(w.current,10)-1,x=Array.from(v.current.keys())[p];x&&(m(x),w.current=null)}}},[m]),B=l.useCallback(d=>{m(null,null,d)},[m]),J=l.useMemo(()=>({remove:R,set:L,handleClick:m,open:B}),[R,L,m,B]);return Z.createElement(Q.Provider,{value:J},e,F)};ct.propTypes={children:r.any,options:r.object,plugins:r.func,uiElements:r.array,id:r.oneOfType([r.string,r.number]),onBeforeOpen:r.func,onOpen:r.func,withCaption:r.bool,withDownloadButton:r.bool};var lt=globalThis&&globalThis.__rest||function(e,t){var c={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(c[n]=e[n]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var o=0,n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&Object.prototype.propertyIsEnumerable.call(e,n[o])&&(c[n[o]]=e[n[o]]);return c};const ut=e=>{var{children:t}=e,c=lt(e,["children"]);const n=l.useRef(),{remove:o,set:S,handleClick:P}=l.useContext(Q),j=l.useCallback(_=>P(n,null,null,_),[]);return l.useLayoutEffect(()=>(S(n,c),()=>o(n)),Object.values(c)),t({ref:n,open:j})};ut.propTypes={children:r.func.isRequired,original:r.string,originalSrcset:r.string,thumbnail:r.string,width:r.oneOfType([r.number,r.string]),height:r.oneOfType([r.number,r.string]),alt:r.string,caption:r.string,content:r.element,html:r.string,id:r.oneOfType([r.number,r.string]),cropped:r.bool};export{ct as G,ut as I};
